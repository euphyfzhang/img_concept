name: Transaction
tables:
  - name: daily_transaction
    description: Daily transaction that contains the date of purchase, store name, item, price of the purchased item. 
    base_table:
      database: RESUME_AI_DB
      schema: IMG_RECG
      table: TRANSACTION
    primary_key:
      columns:
        - TRANSACTION_TIMESTAMP
        - pMERCHANT_NAME
        - ITEM
    time_dimensions:
      - name: TRANSACTION_TIMESTAMP
        expr: Timestamp
        description: transaction timestamp, date of purchase, date time of purchase, time of purchase
        unique: true
        data_type: Timestamp_ntz
    measures:
      - name: daily_purchase
        expr: purchase
        description: total purchase of the day
        synonyms: ["total amount of the day", "purchase of the day", "expense of the day", "cost of the day", "spend of the day"]
        default_aggregation: sum
        data_type: number
      - name: daily_quantity
        expr: count(1)
        description: total times of purchase
        synonyms: ["total times of the day", "quantity of purchase of the day", "number of purchase of the day", "number of spendings of the day"]
        default_aggregation: sum
        data_type: number
      - name: average_purchase
        synonyms:
          - average
        description: average spending across the given period
        expr: daily_purchase/daily_quantity
        data_type: number
        default_aggregation: avg
    dimensions:
      - name: product_id
        expr: product_id
        data_type: number
      - name: merchant_id
        expr: merchant_id
        data_type: number

  - name: product
    description: Product dimension table with unique product identifiers and attributes.
    base_table:
      database: RESUME_AI_DB
      schema: IMG_RECG
      table: DIM_PRODUCT
    primary_key:
      columns:
        - product_id
    dimensions:
      - name: product_id
        expr: product_id
        data_type: number
      - name: product_line
        expr: product_line
        description: Product line associated with revenue
        data_type: varchar
        sample_values:
          - Goldfish cracker
          - Granola bar
          - Pez candy

  - name: Merchant
    description: Merchant dimension table with unique merchant identifiers and merchant name.
    base_table:
      database: RESUME_AI_DB
      schema: IMG_RECG
      table: DIM_MERCHANT
    primary_key:
      columns:
        - _id
    dimensions:
      - name: _id
        expr: merchant_id
        description: the id assigned to the merchant.
        data_type: number
      - name: merchant_name
        expr: merchant_name
        description: the name of the merchant
        data_type: varchar
        sample_values:
          - Loblaws Store
          - Metro Store
          - Costco Store

  - name: Product
    base_table:
      database: RESUME_AI_DB
      schema: IMG_RECG
      table: DIM_PRODUCT
    primary_key:
      columns:
        - _id
    dimensions:
      - name: product_line
        expr: product_line
        cortex_search_service_name: product_line_search_service
        data_type: varchar


relationships:
  - name: transaction_to_product
    left_table: transaction
    right_table: product
    relationship_columns:
      - left_column: product_id
        right_column: _id
    join_type: left_outer
    relationship_type: many_to_one

  - name: revenue_to_merchant
    left_table: transaction
    right_table: merchant
    relationship_columns:
      - left_column: merchant_id
        right_column: _id
    join_type: left_outer
    relationship_type: many_to_one


verified_queries:
 # For eval sample nlimtiaco_sc_3__0
  - name: "daily total expenses"
    question: "daily total expenses"
    verified_at: 202504011425
    verified_by: euphemia
    sql: "
            SELECT
              TO_DATE(TRANSACTION_TIMESTAMP) AS DATE,
              SUM(amount) AS  AMOUNT
            FROM
              IMG_RECG.TRANSACTION
            GROUP BY TO_DATE(TRANSACTION_TIMESTAMP)
            ORDER BY
              TO_DATE(TRANSACTION_TIMESTAMP) DESC;
          "
 # For eval sample nlimtiaco_sc_6__0
  - name: "most recent purchase of the specifc item"
    question: "When is the most recent date of the purchase of Pez Candies?"
    sql: "SELECT ITEM, MAX(TRANSACTION_TIMESTAMP) AS MOST_RECENT_TIMESTAMP
        FROM IMG_RECG.TRANSACTION
        WHERE ITEM = 'Pez candy'
        GROUP BY ITEM;
      "
    verified_at: 202504011426
    verified_by: euphemia
